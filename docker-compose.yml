# =============================================================================
# Server Nexus - Docker Compose for Portainer Git Deployment
# =============================================================================
#
# Portainer Setup:
# 1. Go to Stacks > Add Stack > Repository
# 2. Enter your GitHub repo URL
# 3. Set "Compose path" to: server-nexus/docker-compose.yml
# 4. Enable "Auto update" for automatic redeployment on push
#
# =============================================================================

services:
  server-nexus:
    build:
      context: .
      dockerfile: Dockerfile
    image: server-nexus:latest
    container_name: server-nexus
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - TZ=America/Sao_Paulo
    volumes:
      # Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock:ro
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/system"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 30s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
